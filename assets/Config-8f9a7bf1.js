import{r as _,R as h,P as u,c as se,j as e,e as ae,g as V,h as q,i as re,k as K,l as oe,m as ie,n as S,b as le,o as ce,u as de,C as ue,B as j,q as pe,s as he,t as ge,d as fe,v as me,w as ve,x as xe,y as je}from"./index-02bb1b7a.js";import{S as k}from"./Select-6c321e60.js";import{T as O}from"./Toggle-210c6007.js";import{I as ye,S as be}from"./Input-720848bc.js";import{u as w}from"./useMutation-2bd7ce40.js";import{R as ke}from"./rotate-cw-a0eef89d.js";function I(){return I=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},I.apply(this,arguments)}function Oe(t,r){if(t==null)return{};var s=we(t,r),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)n=o[a],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function we(t,r){if(t==null)return{};var s={},n=Object.keys(t),a,o;for(o=0;o<n.length;o++)a=n[o],!(r.indexOf(a)>=0)&&(s[a]=t[a]);return s}var $=_.forwardRef(function(t,r){var s=t.color,n=s===void 0?"currentColor":s,a=t.size,o=a===void 0?24:a,d=Oe(t,["color","size"]);return h.createElement("svg",I({ref:r,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),h.createElement("polyline",{points:"8 17 12 21 16 17"}),h.createElement("line",{x1:"12",y1:"12",x2:"12",y2:"21"}),h.createElement("path",{d:"M20.88 18.09A5 5 0 0 0 18 9h-1.26A8 8 0 1 0 3 16.29"}))});$.propTypes={color:u.string,size:u.oneOfType([u.string,u.number])};$.displayName="DownloadCloud";const _e=$;function T(){return T=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},T.apply(this,arguments)}function Ce(t,r){if(t==null)return{};var s=Pe(t,r),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)n=o[a],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function Pe(t,r){if(t==null)return{};var s={},n=Object.keys(t),a,o;for(o=0;o<n.length;o++)a=n[o],!(r.indexOf(a)>=0)&&(s[a]=t[a]);return s}var M=_.forwardRef(function(t,r){var s=t.color,n=s===void 0?"currentColor":s,a=t.size,o=a===void 0?24:a,d=Ce(t,["color","size"]);return h.createElement("svg",T({ref:r,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),h.createElement("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),h.createElement("polyline",{points:"16 17 21 12 16 7"}),h.createElement("line",{x1:"21",y1:"12",x2:"9",y2:"12"}))});M.propTypes={color:u.string,size:u.oneOfType([u.string,u.number])};M.displayName="LogOut";const Ne=M;function E(){return E=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},E.apply(this,arguments)}function Se(t,r){if(t==null)return{};var s=ze(t,r),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)n=o[a],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function ze(t,r){if(t==null)return{};var s={},n=Object.keys(t),a,o;for(o=0;o<n.length;o++)a=n[o],!(r.indexOf(a)>=0)&&(s[a]=t[a]);return s}var R=_.forwardRef(function(t,r){var s=t.color,n=s===void 0?"currentColor":s,a=t.size,o=a===void 0?24:a,d=Se(t,["color","size"]);return h.createElement("svg",E({ref:r,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),h.createElement("path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"}))});R.propTypes={color:u.string,size:u.oneOfType([u.string,u.number])};R.displayName="Shield";const Ie=R;function L(){return L=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}return t},L.apply(this,arguments)}function Te(t,r){if(t==null)return{};var s=Ee(t,r),n,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)n=o[a],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(s[n]=t[n])}return s}function Ee(t,r){if(t==null)return{};var s={},n=Object.keys(t),a,o;for(o=0;o<n.length;o++)a=n[o],!(r.indexOf(a)>=0)&&(s[a]=t[a]);return s}var F=_.forwardRef(function(t,r){var s=t.color,n=s===void 0?"currentColor":s,a=t.size,o=a===void 0?24:a,d=Te(t,["color","size"]);return h.createElement("svg",L({ref:r,xmlns:"http://www.w3.org/2000/svg",width:o,height:o,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},d),h.createElement("polyline",{points:"3 6 5 6 21 6"}),h.createElement("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),h.createElement("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),h.createElement("line",{x1:"14",y1:"11",x2:"14",y2:"17"}))});F.propTypes={color:u.string,size:u.oneOfType([u.string,u.number])};F.displayName="Trash2";const Le=F,$e="_root_n9cgg_1",Me="_section_n9cgg_2",Re="_item_n9cgg_14",Fe="_sep_n9cgg_35",We="_label_n9cgg_48",l={root:$e,section:Me,item:Re,sep:Fe,label:We},Be="_fieldset_1ghjp_1",Ae="_input_1ghjp_9",De="_cnt_1ghjp_9",z={fieldset:Be,input:Ae,cnt:De};function Ue({OptionComponent:t,optionPropsList:r,selectedIndex:s,onChange:n}){const a=se("visually-hidden",z.input),o=d=>{n(d.target.value)};return e.jsx("fieldset",{className:z.fieldset,children:r.map((d,c)=>e.jsxs("label",{children:[e.jsx("input",{type:"radio",checked:s===c,name:"selection",value:c,"aria-labelledby":"traffic chart type "+c,onChange:o,className:a}),e.jsx("div",{className:z.cnt,children:e.jsx(t,{...d})})]},c))})}const{useMemo:Ve}=K,qe={plugins:{legend:{display:!1}},scales:{x:{display:!1,type:"category"},y:{display:!1,type:"linear"}}},Q=[23e3,35e3,46e3,33e3,9e4,68e3,23e3,45e3],Ke=[184e3,183e3,196e3,182e3,19e4,186e3,182e3,189e3],Qe=Q;function Ge({id:t}){const r=ae.read(),s=Ve(()=>({labels:Qe,datasets:[{...V,...q[t].up,data:Q},{...V,...q[t].down,data:Ke}]}),[t]),n="chart-"+t;return re(r.Chart,n,s,null,qe),e.jsx("div",{style:{width:100,padding:5},children:e.jsx("canvas",{id:n})})}const{useEffect:He,useState:Je,useCallback:y,useRef:Xe,useMemo:Ye}=K,Ze=[{id:0},{id:1},{id:2},{id:3}],et=[["debug","Debug"],["info","Info"],["warning","Warning"],["error","Error"],["silent","Silent"]],tt=[{key:"port",label:"HTTP Proxy Port"},{key:"socks-port",label:"SOCKS5 Proxy Port"},{key:"mixed-port",label:"Mixed Port"},{key:"redir-port",label:"Redir Port"},{key:"mitm-port",label:"MITM Port"}],nt=[["zh","中文"],["en","English"]],st=[["Direct","Direct"],["Rule","Rule"],["Script","Script"],["Global","Global"]],at=[["gVisor","gVisor"],["System","System"]];function pt(){const{data:t}=oe();return e.jsx(rt,{configs:t})}function rt({configs:t}){var A,D;const r=ie(),[s,n]=S(pe),[a,o]=S(he),d=le(),[c,W]=Je(t),C=Xe(t);He(()=>{C.current!==t&&W(t),C.current=t},[t]);const x=y((i,p)=>{W({...c,[i]:p})},[c]),b=ce(),m=w({mutationFn:ge(d),onSuccess:(i,p)=>{p.tun&&fe(d),b.invalidateQueries({queryKey:["/configs"]})}}),G=y(i=>{const p="allow-lan",f=i;x(p,f),m.mutate({"allow-lan":f})},[m,x]),v=y(({name:i,value:p})=>{switch(i){case"mode":case"log-level":case"allow-lan":case"sniffing":x(i,p),m.mutate({[i]:p});break;case"mitm-port":case"redir-port":case"socks-port":case"mixed-port":case"port":if(p!==""){const f=parseInt(p,10);if(f<0||f>65535)return}x(i,p);break;case"enable":case"stack":x("tun",{...C.current.tun,[i]:p}),m.mutate({tun:{[i]:p}});break;default:return}},[m,x]),H=y(i=>v(i.target),[v]),B=y(i=>{const p=i.target,{name:f,value:U}=p;switch(f){case"port":case"socks-port":case"mixed-port":case"redir-port":case"mitm-port":{const N=parseInt(U,10);if(N<0||N>65535)return;m.mutate({[f]:N});break}case"latencyTestUrl":{n(U);break}default:throw new Error(`unknown input name ${f}`)}},[m,n]),J=w({mutationFn:me(d),onSuccess:()=>{b.invalidateQueries({queryKey:["/configs"]})}}),X=w({mutationFn:ve(d),onSuccess:()=>{b.invalidateQueries({queryKey:["/configs"]})}}),Y=w({mutationFn:xe(d),onSuccess:()=>{b.invalidateQueries({queryKey:["/configs"]})}}),Z=Ye(()=>{const i=c.mode;return typeof i=="string"&&i[0].toUpperCase()+i.slice(1)},[c.mode]),[ee,te]=S(je),{t:g,i18n:P}=de(),ne=P.language&&P.language.indexOf("zh")>-1?"zh":"en";return e.jsxs("div",{children:[e.jsx(ue,{title:g("Config")}),e.jsx("div",{className:l.root,children:tt.map(i=>c[i.key]!==void 0?e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:i.label}),e.jsx(ye,{name:i.key,value:c[i.key],onChange:H,onBlur:B})]},i.key):null)}),e.jsx("div",{className:l.sep,children:e.jsx("div",{})}),e.jsxs("div",{className:l.section,children:[e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:"Mode"}),e.jsx(k,{options:st,selected:Z,onChange:i=>v({name:"mode",value:i.target.value})})]}),e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:"Log Level"}),e.jsx(k,{options:et,selected:c["log-level"],onChange:i=>v({name:"log-level",value:i.target.value})})]})]}),e.jsx("div",{className:l.sep,children:e.jsx("div",{})}),e.jsxs("div",{className:l.section,children:[e.jsxs("div",{className:l.item,children:[e.jsx(O,{id:"config-allow-lan",checked:c["allow-lan"],onChange:G}),e.jsx("label",{htmlFor:"config-allow-lan",children:g("allow_lan")})]}),c.tun!==void 0?e.jsxs("div",{className:l.item,children:[e.jsx(O,{id:"config-sniffing",checked:c.sniffing,onChange:i=>v({name:"sniffing",value:i})}),e.jsx("label",{htmlFor:"config-sniffing",children:g("tls_sniffing")})]}):null]}),c.tun!==void 0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:l.sep,children:e.jsx("div",{})}),e.jsxs("div",{className:l.section,children:[e.jsxs("div",{className:l.item,children:[e.jsx(O,{id:"config-tun-enable",checked:(A=c.tun)==null?void 0:A.enable,onChange:i=>v({name:"enable",value:i})}),e.jsx("label",{htmlFor:"config-tun-enable",children:g("enable_tun_device")})]}),e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:"TUN IP Stack"}),e.jsx(k,{options:at,selected:(D=c.tun)==null?void 0:D.stack,onChange:i=>v({name:"stack",value:i.target.value})})]})]})]}):null,e.jsx("div",{className:l.sep,children:e.jsx("div",{})}),e.jsxs("div",{className:l.section,children:[e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:"Reload"}),e.jsx(j,{start:e.jsx(ke,{size:16}),label:g("reload_config_file"),onClick:()=>J.mutate()})]}),c.tun!==void 0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:"GEO Databases"}),e.jsx(j,{start:e.jsx(_e,{size:16}),label:g("update_geo_databases_file"),onClick:()=>X.mutate()})]}),e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:"FakeIP"}),e.jsx(j,{start:e.jsx(Le,{size:16}),label:g("flush_fake_ip_pool"),onClick:()=>Y.mutate()})]}),e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:"MITM"}),e.jsx(j,{start:e.jsx(Ie,{size:16}),label:g("install_certificate"),link:"http://mitm.clash/cert.crt",target:"_blank"})]})]}):null]}),e.jsx("div",{className:l.sep,children:e.jsx("div",{})}),e.jsxs("div",{className:l.section,children:[e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:g("latency_test_url")}),e.jsx(be,{name:"latencyTestUrl",type:"text",value:s,onBlur:B})]}),e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:g("lang")}),e.jsx("div",{children:e.jsx(k,{options:nt,selected:ne,onChange:i=>P.changeLanguage(i.target.value)})})]}),e.jsxs("div",{children:[e.jsx("div",{className:l.label,children:g("chart_style")}),e.jsx(Ue,{OptionComponent:Ge,optionPropsList:Ze,selectedIndex:a,onChange:i=>o(parseInt(i,10))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:l.label,children:[g("current_backend"),e.jsx("p",{children:d.baseURL})]}),e.jsx("div",{className:l.label,children:"Action"}),e.jsx(j,{start:e.jsx(Ne,{size:16}),label:g("switch_backend"),onClick:()=>r("/backend")})]}),e.jsxs("div",{className:l.item,children:[e.jsx(O,{id:"dark-mode-pure-black-toggle",checked:ee,onChange:te}),e.jsx("label",{htmlFor:"dark-mode-pure-black-toggle",children:g("dark_mode_pure_black_toggle_label")})]})]})]})}export{pt as default};
