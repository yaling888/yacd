import{r as _,R as S,P as x,z as G,A as K,D as m,j as s,E as F,F as U,G as q,n as k,b as V,H as Q,u as X,C as Z,S as ee,J as te,k as oe,c as ne,K as re,L as se}from"./index-02bb1b7a.js";import{a as ae,F as ce}from"./index.esm-c03c40e8.js";import{d as le}from"./debounce-c1ba2006.js";import{S as ie}from"./Select-6c321e60.js";import{u as ue}from"./useRemainingViewPortHeight-acc3f302.js";import{F as C,p as O}from"./Fab-d4498bc7.js";import{P as E,a as z}from"./play-6f22af20.js";function R(){return R=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},R.apply(this,arguments)}function ge(e,o){if(e==null)return{};var t=de(e,o),n,a;if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],!(o.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}function de(e,o){if(e==null)return{};var t={},n=Object.keys(e),a,r;for(r=0;r<n.length;r++)a=n[r],!(o.indexOf(a)>=0)&&(t[a]=e[a]);return t}var T=_.forwardRef(function(e,o){var t=e.color,n=t===void 0?"currentColor":t,a=e.size,r=a===void 0?24:a,c=ge(e,["color","size"]);return S.createElement("svg",R({ref:o,xmlns:"http://www.w3.org/2000/svg",width:r,height:r,viewBox:"0 0 24 24",fill:"none",stroke:n,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},c),S.createElement("circle",{cx:"11",cy:"11",r:"8"}),S.createElement("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"}))});T.propTypes={color:x.string,size:x.oneOfType([x.string,x.number])};T.displayName="Search";const he=T,B="/logs",me=new TextDecoder("utf-8"),fe=()=>Math.floor((1+Math.random())*65536).toString(16);let M=!1,p=!1,v="",d;function P(e,o){let t;try{t=JSON.parse(e)}catch{console.log("JSON.parse error",JSON.parse(e))}const n=new Date,a=pe(n);t.time=a,t.id=+n-0+fe(),t.even=M=!M,o(t)}function pe(e){const o=e.getFullYear()%100,t=m(e.getMonth()+1,2),n=m(e.getDate(),2),a=m(e.getHours(),2),r=m(e.getMinutes(),2),c=m(e.getSeconds(),2);return`${o}-${t}-${n} ${a}:${r}:${c}`}function A(e,o){return e.read().then(({done:t,value:n})=>{const a=me.decode(n,{stream:!t});v+=a;const r=v.split(`
`),c=r[r.length-1];for(let i=0;i<r.length-1;i++)P(r[i],o);if(t){P(c,o),v="",console.log("GET /logs streaming done"),p=!1;return}else v=c;return A(e,o)})}function $(e){const o=Object.keys(e);return o.sort(),o.map(t=>e[t]).join("|")}let D,h;function xe(e,o){if(e.logLevel==="uninit"||p||d&&d.readyState===1)return;const t=G(e,B);d=new WebSocket(t),d.addEventListener("error",()=>{ve(e,o)}),d.addEventListener("message",function(n){P(n.data,o)})}function b(){d.close(),h&&h.abort()}function ve(e,o){if(h&&$(e)!==D)h.abort();else if(p)return;p=!0,D=$(e),h=new AbortController;const t=h.signal,{url:n,init:a}=K(e);fetch(n+B+"?level="+e.logLevel,{...a,signal:t}).then(r=>{const c=r.body.getReader();A(c,o)},r=>{p=!1,!t.aborted&&console.log("GET /logs error:",r.message)})}const _e="_RuleSearch_bd30s_1",je="_RuleSearchContainer_bd30s_5",Se="_inputWrapper_bd30s_10",be="_input_bd30s_10",ye="_iconWrapper_bd30s_36",f={RuleSearch:_e,RuleSearchContainer:je,inputWrapper:Se,input:be,iconWrapper:ye};function Le({dispatch:e,searchText:o,updateSearchText:t}){const[n,a]=_.useState(o),r=_.useCallback(u=>{e(t(u))},[e,t]),c=_.useMemo(()=>le(r,300),[r]),i=u=>{a(u.target.value),c(u.target.value)};return s.jsx("div",{className:f.RuleSearch,children:s.jsxs("div",{className:f.RuleSearchContainer,children:[s.jsx("div",{className:f.inputWrapper,children:s.jsx("input",{type:"text",value:n,onChange:i,className:f.input})}),s.jsx("div",{className:f.iconWrapper,children:s.jsx(he,{size:20})})]})})}const Re=e=>({searchText:U(e),updateSearchText:q}),Pe=F(Re)(Le),Te="_logMeta_mgu9f_1",we="_logType_mgu9f_8",Ne="_logTime_mgu9f_18",We="_logText_mgu9f_24",ke="_logsWrapper_mgu9f_37",Ce="_logPlaceholder_mgu9f_51",Oe="_logPlaceholderIcon_mgu9f_64",Ee="_search_mgu9f_68",ze="_logLevel_mgu9f_72",Me="_searchBox_mgu9f_79",l={logMeta:Te,logType:we,logTime:Ne,logText:We,logsWrapper:ke,logPlaceholder:Ce,logPlaceholderIcon:Oe,search:Ee,logLevel:ze,searchBox:Me},$e=[["debug","Debug"],["info","Info"],["warning","Warning"],["error","Error"]],{useCallback:y,memo:De,useEffect:I,useRef:Ie}=oe,L=30,Fe={debug:"#28792c",info:"var(--bg-log-info-tag)",warning:"#b99105",error:"#c11c1c"};function Be({time:e,even:o,payload:t,type:n}){const a=ne({even:o},"log");return s.jsx("div",{className:a,children:s.jsxs("div",{className:l.logMeta,children:[s.jsx("div",{className:l.logTime,children:e}),s.jsx("div",{className:l.logType,style:{backgroundColor:Fe[n]},children:n}),s.jsx("div",{className:l.logText,children:t})]})})}function Ae(e,o){return o[e].id}const H=De(({index:e,style:o,data:t})=>{const n=t[e];return s.jsx("div",{style:o,children:s.jsx(Be,{...n})})},ae);H.displayName="MemoRow";function He({dispatch:e,logs:o}){const t=Ie(0),[n,a]=k(re),[r,c]=k(se),i=V(),u=y(()=>{t.current===1&&(t.current=0,b()),c(!r)},[r,c]),J=y(j=>{const W=j.target.value;n!==W&&(t.current===1&&(t.current=0,b()),a(W))},[n,a]),w=y(j=>e(Q(j)),[e]);I(()=>()=>{t.current===1&&(t.current=0,b())},[]),I(()=>{r||(t.current===0&&(t.current=1),xe({...i,logLevel:n},w))},[r,i,n,w]);const[Y,N]=ue(),{t:g}=X();return s.jsxs("div",{children:[s.jsx(Z,{title:g("Logs")}),s.jsxs("div",{className:l.search,children:[s.jsx("div",{className:l.logLevel,children:s.jsx(ie,{options:$e,selected:n,onChange:J})}),s.jsx("div",{className:l.searchBox,children:s.jsx(Pe,{})})]}),s.jsx("div",{ref:Y,style:{paddingBottom:L},children:o.length===0?s.jsxs("div",{className:l.logPlaceholder,style:{height:N-L},children:[s.jsx("div",{className:l.logPlaceholderIcon,children:s.jsx(ee,{width:200,height:200})}),s.jsx("div",{children:g("no_logs")}),s.jsx(C,{icon:r?s.jsx(E,{size:16}):s.jsx(z,{size:16}),mainButtonStyles:r?{background:"#e74c3c"}:{},style:O,text:g(r?"Resume Refresh":"Pause Refresh"),onClick:u})]}):s.jsxs("div",{className:l.logsWrapper,children:[s.jsx(ce,{height:N-L,width:"100%",itemCount:o.length,itemSize:80,itemData:o,itemKey:Ae,children:H}),s.jsx(C,{icon:r?s.jsx(E,{size:16}):s.jsx(z,{size:16}),mainButtonStyles:r?{background:"#e74c3c"}:{},style:O,text:g(r?"Resume Refresh":"Pause Refresh"),onClick:u})]})})]})}const Je=e=>({logs:te(e)}),Xe=F(Je)(He);export{Xe as default};
